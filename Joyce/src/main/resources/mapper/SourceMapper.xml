<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.moon.joyce.example.mapper.SourceMapper">
    <select id="selectList" resultType="com.moon.joyce.example.entity.Source">
        SELECT
               s.id,
               s.create_by,
               s.create_time,
               s.delete_flag,
               s.update_by,
               s.update_time,
               s.source_name,
               s.type,
               s.url,
               s.sort,
               s.user_id,
               u.username
             FROM springboot.source s
             LEFT JOIN springboot.user u
             ON s.user_id = u.id
             WHERE s.delete_flag = 0
            <if test="userId!=null">
                AND s.user_id = #{userId}
            </if>
            <if test="username!=null and username!=''">
                 AND u.username LIKE CONCAT('%',#{username},'%')
             </if>
            <if test="type!=null and type!=''">
                AND s.type = #{type}
            </if>
            <if test="url!=null and url!=''">
                AND s.url LIKE CONCAT('%',#{url},'%')
            </if>
            <if test="offset!=null and offset!=0 and  pageNumber!=null and  pageNumber!=0  ">
                LIMIT #{offset}, #{pageNumber}
            </if>
            ORDER BY s.sort ,s.id
    </select>

    <select id="selectCount" resultType="java.lang.Integer">
        SELECT count(*) FROM springboot.source s
        LEFT JOIN springboot.user u
        ON s.user_id = u.id
        WHERE s.delete_flag = 0
        <if test="username!=null and username!=''">
            AND u.username LIKE CONCAT('%',#{username},'%')
        </if>
        <if test="type!=null and type!=''">
            AND s.type = #{type}
        </if>
        <if test="url!=null and url!=''">
            AND s.url LIKE CONCAT('%',#{url},'%')
        </if>
    </select>
</mapper>