<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.moon.joyce.example.mapper.ChatRecordMapper">
    <sql id="chatRecordColumns">
               cr.id,
               cr.create_by,
               cr.create_time,
               cr.delete_flag,
               cr.update_by,
               cr.update_time,
               cr.user_a_id,
               u.username AS userAName,
               u.file_url AS aFileUrl,
               u.nickname AS aNickname,
               cr.user_b_id,
               u2.username AS userBName,
               u2.file_url AS bFileUrl,
               u2.nickname AS bNickname,
               cr.content
    </sql>
    <select id="selectAll" resultType="com.moon.joyce.example.entity.ChatRecord">
        SELECT
             <include refid="chatRecordColumns"/>
        FROM springboot.chat_record cr
        LEFT JOIN springboot.user u
        ON cr.user_a_id =u.id
        LEFT JOIN springboot.user u2
        ON cr.user_b_id = u2.id
        WHERE (cr.user_a_id = #{userAId} AND cr.user_b_id = #{userBId})
        OR (cr.user_b_id = #{userBId} AND cr.user_a_id = #{userAId})
    </select>
</mapper>